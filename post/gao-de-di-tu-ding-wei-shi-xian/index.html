<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" >

<title>高德地图定位实现 | 暮雨今汐</title>
<meta name="description" content="说什么王权富贵 / 怕什么戒律清规">

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
<link rel="shortcut icon" href="https://zhoujingpiao.github.io/favicon.ico?v=1562409018173">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">
<link rel="stylesheet" href="https://zhoujingpiao.github.io/styles/main.css">


  
    <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css" />
  

  


<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
<script src="https://cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>

<link rel="stylesheet" href="https://unpkg.com/aos@next/dist/aos.css" />



  </head>
  <body>
    <div id="app" class="main">

      <div class="sidebar" :class="{ 'full-height': menuVisible }">
  <div class="top-container" data-aos="fade-right">
    <div class="top-header-container">
      <a class="site-title-container" href="https://zhoujingpiao.github.io">
        <img src="https://zhoujingpiao.github.io/images/avatar.png?v=1562409018173" class="site-logo">
        <h1 class="site-title">暮雨今汐</h1>
      </a>
      <div class="menu-btn" @click="menuVisible = !menuVisible">
        <div class="line"></div>
      </div>
    </div>
    <div>
      
        
          <a href="/" class="site-nav">
            首页
          </a>
        
      
        
          <a href="/archives" class="site-nav">
            归档
          </a>
        
      
        
          <a href="/post/about" class="site-nav">
            关于
          </a>
        
      
    </div>
  </div>
  <div class="bottom-container" data-aos="flip-up" data-aos-offset="0">
    <div class="social-container">
      
        
          <a class="social-link" href="https://github.com/zhoujingpiao" target="_blank">
            <i class="fab fa-github"></i>
          </a>
        
      
        
      
        
          <a class="social-link" href="https://weibo.com/2407408715" target="_blank">
            <i class="fab fa-weibo"></i>
          </a>
        
      
        
      
        
      
    </div>
    <div class="site-description">
      说什么王权富贵 / 怕什么戒律清规
    </div>
    <div class="site-footer">
      Powered by Gridea | <a class="rss" href="https://zhoujingpiao.github.io/atom.xml" target="_blank">RSS</a>
    </div>
  </div>
</div>


      <div class="main-container">
        <div class="content-container" data-aos="fade-up">
          <div class="post-detail">
            <h2 class="post-title">高德地图定位实现</h2>
            <div class="post-date">2018-01-23</div>
            
              <div class="feature-container" style="background-image: url('https://zhoujingpiao.github.io/post-images/gao-de-di-tu-ding-wei-shi-xian.jpg')">
              </div>
            
            <div class="post-content">
              <p>GoogleMap不存在，SouGou占有率不高，BaiDu niao性差，所以实现地图肯定首选高德啦......</p>
<!-- more -->
<h2 id="1创建应用">1.创建应用</h2>
<blockquote>
<p>官方文档地址: http://lbs.amap.com/api/android-location-sdk/guide/create-project/get-key</p>
</blockquote>
<ul>
<li>
<p>注册账号,创建对应的应用.</p>
</li>
<li>
<p>[外链图片转存失败(img-Lr6jBQE8-1562408859358)(https://i.imgur.com/S5xtRvc.png)]</p>
</li>
<li>
<p>这里基本就是填资料啦,没什么难的地方,只不过创建应用之后设置key的时候,要获取SHA1,</p>
</li>
<li>
<p>[外链图片转存失败(img-ljdLgIf7-1562408859360)(https://i.imgur.com/dJJVlzu.png)]</p>
</li>
<li>
<p>我的获取方法:androidstudio3.0,利用Terminal工具:</p>
</li>
<li>
<p>[外链图片转存失败(img-uemJSQFE-1562408859361)(https://i.imgur.com/OqlJWhb.png)]</p>
</li>
<li>
<p>根据签名文件分别获取debug和release的SHA1,直接贴主要命令行吧:</p>
<pre><code> D:\A_Git3\XHBC&gt;cd D:\JDK8\bin
 D:\JDK8\bin&gt;keytool -v -list -keystore C:\Users\zjp\.android\debug.keystore
 *****************  WARNING WARNING WARNING  *****************
 条目类型: PrivateKeyEntry
 证书指纹:
          MD5: 0A:02:44:CC:D2:65:A************62:ED:A3:DD:34
          SHA1: 79:BC:05:39:AA:35:CD:7************F:33:CA
          SHA256: 9E:F0:B1:1C:8B:59:C6:2A:17:A************7:FE:E7:EB:93
          签名算法名称: SHA1
          版本: 1
 *******************************************
 D:\JDK8\bin&gt;keytool -v -list -keystore D:\SIGN\x**.jks
 条目类型: PrivateKeyEntry
 证书指纹:
          MD5: 04:8E:1C:84:39:DF:78************:15:E9:F6
          SHA1: 23:64:74:64:E0:80:A************:73:10:9E:8A:3D:57:EA
          SHA256: 2A:5F:BE:E7:94:2B:DF:C************:BC:42:57:51:4D:EA
          签名算法名称: SHA256withRSA
 *******************************************
</code></pre>
</li>
</ul>
<h2 id="2-android-studio-配置工程">2 Android Studio 配置工程</h2>
<blockquote>
<p>官方文档地址: http://lbs.amap.com/api/android-location-sdk/guide/create-project/android-studio-create-project</p>
</blockquote>
<ul>
<li>
<p>这里基本照着文档走就没问题,注意问题如下:</p>
<ul>
<li>
<ol>
<li>[外链图片转存失败(img-FBJkMBqH-1562408859361)(https://i.imgur.com/VugUi5Y.png)]
此处,只是获取当前定位,比如获取当前位于哪个城市直接用定位就好,要显示地图就多下载一个2D,要添加复杂图层或者添加多个标记点等操作就要用到3D地图</li>
</ol>
</li>
<li>2.2D地图不用下载.so库,3D地图要搭配.so库,主选arm架构的,笔记市场占有率在那摆着</li>
</ul>
</li>
</ul>
<h2 id="3获取定位数据">3.获取定位数据</h2>
<blockquote>
<p>官方文档地址: http://lbs.amap.com/api/android-location-sdk/guide/android-location/getlocation</p>
</blockquote>
<h3 id="31-配置androidmainfestxml文件">3.1 配置AndroidMainfest.xml文件</h3>
<pre><code>	&lt;!-- 高德地图权限--&gt;
	&lt;!--用于进行网络定位--&gt;
	&lt;uses-permission android:name=&quot;android.permission.ACCESS_COARSE_LOCATION&quot;&gt;&lt;/uses-permission&gt;
	&lt;!--用于访问GPS定位--&gt;
	&lt;uses-permission android:name=&quot;android.permission.ACCESS_FINE_LOCATION&quot;&gt;&lt;/uses-permission&gt;
	&lt;!--用于获取运营商信息，用于支持提供运营商信息相关的接口--&gt;
	&lt;uses-permission android:name=&quot;android.permission.ACCESS_NETWORK_STATE&quot;&gt;&lt;/uses-permission&gt;
	&lt;!--用于访问wifi网络信息，wifi信息会用于进行网络定位--&gt;
	&lt;uses-permission android:name=&quot;android.permission.ACCESS_WIFI_STATE&quot;&gt;&lt;/uses-permission&gt;
	&lt;!--用于获取wifi的获取权限，wifi信息会用来进行网络定位--&gt;
	&lt;uses-permission android:name=&quot;android.permission.CHANGE_WIFI_STATE&quot;&gt;&lt;/uses-permission&gt;
	&lt;!--用于访问网络，网络定位需要上网--&gt;
	&lt;uses-permission android:name=&quot;android.permission.INTERNET&quot;&gt;&lt;/uses-permission&gt;
	&lt;!--用于读取手机当前的状态--&gt;
	&lt;uses-permission android:name=&quot;android.permission.READ_PHONE_STATE&quot;&gt;&lt;/uses-permission&gt;
	&lt;!--用于写入缓存数据到扩展存储卡--&gt;
	&lt;uses-permission android:name=&quot;android.permission.WRITE_EXTERNAL_STORAGE&quot;&gt;&lt;/uses-permission&gt;
	&lt;!--用于申请调用A-GPS模块--&gt;
	&lt;uses-permission android:name=&quot;android.permission.ACCESS_LOCATION_EXTRA_COMMANDS&quot;&gt;&lt;/uses-permission&gt;
	&lt;!--用于申请获取蓝牙信息进行室内定位--&gt;
	&lt;uses-permission android:name=&quot;android.permission.BLUETOOTH&quot;&gt;&lt;/uses-permission&gt;
	&lt;uses-permission android:name=&quot;android.permission.BLUETOOTH_ADMIN&quot;&gt;&lt;/uses-permission&gt;
	
	&lt;application
	        android:icon=&quot;@mipmap/ic_launcher&quot;
	        android:label=&quot;@string/app_name&quot;
	        android:theme=&quot;@style/AppTheme&quot;&gt;
	        &lt;!--设置key--&gt;
	        &lt;meta-data
	            android:name=&quot;com.amap.api.v2.apikey&quot;
	            android:value=&quot;这里填写第一步你申请的那个key&quot; /&gt;
	        &lt;!--声明定位service--&gt;
	        &lt;service android:name=&quot;com.amap.api.location.APSService&quot;&gt;&lt;/service&gt;
	&lt;/application&gt;
</code></pre>
<h3 id="31-在布局文件中添加地图显示控件">3.1 在布局文件中添加地图显示控件</h3>
<ul>
<li>此处注意2D和3D地图因为添加的jar包不同其MapView路径也是不同的,如下
<ul>
<li>
<p>2D:</p>
<pre><code>  &lt;com.amap.api.maps2d.MapView
  	android:id=&quot;@+id/map&quot;
  	android:layout_width=&quot;fill_parent&quot;
  	android:layout_height=&quot;fill_parent&quot; /&gt;		
</code></pre>
</li>
<li>
<p>3D:</p>
<pre><code>   &lt;com.amap.api.maps.MapView
          android:id=&quot;@+id/map&quot;
          android:layout_width=&quot;match_parent&quot;
          android:layout_height=&quot;match_parent&quot; /&gt;
</code></pre>
</li>
</ul>
</li>
</ul>
<h3 id="33-activity里面进行注册配置">3.3 Activity里面进行注册配置</h3>
<blockquote>
<p>此处参考这篇博文,写的很详细了,如侵权请告知我立即删改,此处我在这个哥们写的基础上加上一点我自己的理解吧: https://www.jianshu.com/p/c3dc0cea0a2d</p>
</blockquote>
<pre><code>	public class MainActivity extends AppCompatActivity implements  LocationSource, AMapLocationListener {
	
	    private MapView mapView;	//地图控件
	    private AMap aMap;			//地图对象
	
	    //定位需要的声明,初始化的配置
	    private AMapLocationClient mLocationClient = null;			//发起定位
	    private AMapLocationClientOption mLocationOption = null;	//参数设置
	    private OnLocationChangedListener mListener = null;			//监听器
		
		//标识，用于判断是否只显示一次定位信息和用户重新定位
    	private boolean isFirstLoc = true;

	    @Override
	    protected void onCreate(Bundle savedInstanceState) {
	        super.onCreate(savedInstanceState);
	        setContentView(R.layout.activity_main);
	
	        mapView = (MapView) findViewById(R.id.map);
			//这句是重点,如果是自定义BaseActivity的要注意重写onCreate()方法
	        mapView.onCreate(savedInstanceState);	

	        //获取地图对象
	        aMap = mapView.getMap();
	
	        //设置显示定位按钮 并且可以点击
	        UiSettings settings = aMap.getUiSettings();
	        //设置定位监听
	        aMap.setLocationSource(this);
	        // 是否显示定位按钮
	        settings.setMyLocationButtonEnabled(true);
	        // 是否可触发定位并显示定位层
	        aMap.setMyLocationEnabled(true);
	
	        //定位的小图标
	        MyLocationStyle myLocationStyle = new MyLocationStyle();
	        myLocationStyle.myLocationIcon(BitmapDescriptorFactory.fromResource(R.mipmap.point_map));
	        myLocationStyle.radiusFillColor(android.R.color.transparent);
	        myLocationStyle.strokeColor(android.R.color.transparent);
	        aMap.setMyLocationStyle(myLocationStyle);
	
	        //开始定位
	        initLocation();
	    }
	
	    /**
		*  定位
		*/
	    private void initLocation() {
	        mLocationClient = new AMapLocationClient(getApplicationContext());
	        //设置定位回调监听
	        mLocationClient.setLocationListener(this);
	        //初始化定位参数
	        mLocationOption = new AMapLocationClientOption();
	        //设置定位模式
			//Hight_Accuracy为高精度模式，Battery_Saving为低功耗模式，Device_Sensors是仅设备模式
	        mLocationOption.setLocationMode(AMapLocationClientOption.AMapLocationMode.Hight_Accuracy);
	        //设置是否返回地址信息（默认返回地址信息）
	        mLocationOption.setNeedAddress(true);
	        //设置是否只定位一次,默认为false
	        mLocationOption.setOnceLocation(false);
	        //设置是否强制刷新WIFI，默认为强制刷新
	        mLocationOption.setWifiActiveScan(true);
	        //设置是否允许模拟位置,默认为false，不允许模拟位置
	        mLocationOption.setMockEnable(false);
	        //设置定位间隔,单位毫秒,默认为2000ms
	        mLocationOption.setInterval(2000);
	        //给定位客户端对象设置定位参数
	        mLocationClient.setLocationOption(mLocationOption);
	        //启动定位
	        mLocationClient.startLocation();
	    }
	
	    //定位回调函数
	    @Override
	    public void onLocationChanged(AMapLocation amapLocation) {
	        if (amapLocation != null) {
	            if (amapLocation.getErrorCode() == 0) {
	                //定位成功回调信息，设置相关消息
	                amapLocation.getLocationType();//获取当前定位结果来源，如网络定位结果，详见官方定位类型表
	                amapLocation.getLatitude();		//获取纬度
	                amapLocation.getLongitude();	//获取经度
	                amapLocation.getAccuracy();		//获取精度信息
	                amapLocation.getCity();			//城市信息
	
	                // 如果不设置标志位，此时再拖动地图时，它会不断将地图移动到当前的位置
	                if (isFirstLoc) {
	                    //设置缩放级别
	                    aMap.moveCamera(CameraUpdateFactory.zoomTo(17));
	                    //将地图移动到定位点
	                    aMap.moveCamera(CameraUpdateFactory.changeLatLng(new LatLng(amapLocation.getLatitude(), amapLocation.getLongitude())));
	                    //点击定位按钮 能够将地图的中心移动到定位点
	                    mListener.onLocationChanged(amapLocation);
	                    //添加图钉
	                    aMap.addMarker(getMarkerOptions(amapLocation));
	                    //获取定位信息
	                    StringBuffer buffer = new StringBuffer();
	                    buffer.append(amapLocation.getCountry() + &quot;&quot; + amapLocation.getProvince() + &quot;&quot; + amapLocation.getCity() + &quot;&quot; + amapLocation.getProvince() + &quot;&quot; + amapLocation.getDistrict() + &quot;&quot; + amapLocation.getStreet() + &quot;&quot; + amapLocation.getStreetNum());
	                    Toast.makeText(getApplicationContext(), buffer.toString(), Toast.LENGTH_LONG).show();
	                    isFirstLoc = false;
	                }
	            } else {
	                //显示错误信息ErrCode是错误码，errInfo是错误信息，详见错误码表。
	                Log.e(&quot;AmapError&quot;, &quot;location Error, ErrCode:&quot;
	                        + amapLocation.getErrorCode() + &quot;, errInfo:&quot;
	                        + amapLocation.getErrorInfo());
	                Toast.makeText(getApplicationContext(), &quot;定位失败&quot;, Toast.LENGTH_LONG).show();
	            }
	        }
	    }
	
	    //自定义一个图钉，并且设置图标，当我们点击图钉时，显示设置的信息
	    private MarkerOptions getMarkerOptions(AMapLocation amapLocation) {
	         //设置图钉选项
	        MarkerOptions options = new MarkerOptions();
	        //图标
	        options.icon(BitmapDescriptorFactory.fromResource(R.mipmap.fire));
	        //位置
	        options.position(new LatLng(amapLocation.getLatitude(), amapLocation.getLongitude()));
	        StringBuffer buffer = new StringBuffer();
	        buffer.append(amapLocation.getCountry() + &quot;&quot; + amapLocation.getProvince() + &quot;&quot; + amapLocation.getCity() +  &quot;&quot; + amapLocation.getDistrict() + &quot;&quot; + amapLocation.getStreet() + &quot;&quot; + amapLocation.getStreetNum());
	        //标题
	        options.title(buffer.toString());
	        //子标题
	        options.snippet(&quot;这是我设置的标题&quot;);
	        //设置多少帧刷新一次图片资源
	        options.period(60);
	        return options;
	    }

	    @Override
	    public void activate(OnLocationChangedListener listener) {
	        mListener = listener;
	    }
	
	    @Override
	    public void deactivate() {
	        mListener = null;
	    }
	
	
	    @Override
	    protected void onResume() {
	        super.onResume();
	        mapView.onResume();
	    }
	
	    @Override
	    protected void onPause() {
	        super.onPause();
	        mapView.onPause();
	    }
	
	    @Override
	    protected void onSaveInstanceState(Bundle outState) {
	        super.onSaveInstanceState(outState);
	        mapView.onSaveInstanceState(outState);
	    }

	    @Override
	    protected void onDestroy() {
	        super.onDestroy();
	        mapView.onDestroy();
	    }
	}
</code></pre>
<h3 id="34-在真机上运行">3.4 在真机上运行</h3>
<h2 id="4总结">4.总结</h2>
<ul>
<li>其实这类第三方的,仔细一点照着文档走是没什么大问题的,也不是每家都跟某信支付的文档一样坑嘛。
遇到bug多搜一下,基本我的感觉就是第一次接的时候比较繁琐,但是自己弄好成功之后,基本理一下思路,自己心里有谱了后面就会觉得很清晰了.就是这些。</li>
</ul>

            </div>
            
              <div class="tag-container">
                
                  <a href="https://zhoujingpiao.github.io/tag/RWL8cUFFN" class="tag">
                    Android
                  </a>
                
              </div>
            
            
              <div class="next-post">
                <div class="next">下一篇</div>
                <a href="https://zhoujingpiao.github.io/post/android-mian-shi-zong-jie-2017-ban">
                  <h3 class="post-title">
                    Android面试总结2017版
                  </h3>
                </a>
              </div>
            

            
              
                <div id="gitalk-container" data-aos="fade-in"></div>
              

              
            

          </div>

        </div>
      </div>
    </div>

    <script src="https://unpkg.com/aos@next/dist/aos.js"></script>

<script type="application/javascript">

AOS.init();

hljs.initHighlightingOnLoad()

var app = new Vue({
  el: '#app',
  data: {
    menuVisible: false,
  },
})

</script>



  
    <script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
    <script>

      var gitalk = new Gitalk({
        clientID: 'd5a826af873be485f97c',
        clientSecret: 'f745c9fa3c0f3529b094fb06fd020ca37a919755',
        repo: 'zhoujingpiao.github.io',
        owner: 'zhoujingpiao',
        admin: ['zhoujingpiao'],
        id: (location.pathname).substring(0, 49),      // Ensure uniqueness and length less than 50
        distractionFreeMode: false  // Facebook-like distraction free mode
      })

      gitalk.render('gitalk-container')

    </script>
  

  




  </body>
</html>
